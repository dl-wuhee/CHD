\chapter{有限差分法}
上一章推导的控制方程的解析解，如果可以得出，将可以给出所有因变量在求解域上连续函
数。然而，除了个别极其简单的流动情况，这类方程的解析解往往很难获得。因此，我们只
能退而求其次，通过将连续的空间和时间分割成不连续的散点（分别称为网格点和时间节点
），并将控制方程在这些散点上离散，得出与原方程近似但可求解的代数方程组，最终得出
原方程在这些散点上的近似解。

在实际的数值模拟过程中，网格点或时间节点的划分是不均匀的。为了后续推导方便，本章
假定网格点和时间节点的间距都是均匀分布的。此外，本章只关注结构网格，对非结构网格
可参见其他参考书。

\section{泰勒展开}
考虑一个$x$的连续函数$f(x)$在$x$处的所有阶导数都存在。那么，$f$在点$x+\Delta x$
处的值可以通过在点$x$处的泰勒级数展开来估算。
\begin{equation}
  f(x+\Delta x)
  =
  f(x)
  +
  \frac{\partial f}{\partial x}\Delta x
  +
  \frac{\partial^{2} f}{\partial x^{2}}\frac{\Delta x^{2}}{2}
  +
  \cdots
  +
  \frac{\partial^{n} f}{\partial x^{n}}\frac{\Delta x^{n}}{n!}
  +
  \cdots
\end{equation}

假定$f(x)=\sin{2\pi x}$，且已知$x=0.2$处，函数值$f=0.9511$。我们希望估算
$x+\Delta x=0.22$处的函数值。根据方程表达式，该点的精确值为0.9823。首先，我们利
用泰勒级数展开的第一项来估算，有
\begin{equation}
  \begin{aligned}
    f(x+\Delta x) \approx f(x)  \\
    f(0.22) \approx f(0.2) = 0.9511
  \end{aligned} 
\end{equation}
估算值的相对误差为$(0.9823-0.9511)/0.9823=3.176\%$。接着，我们利用展开式的前两项
来估算，有
\begin{equation}
  \begin{aligned}
    f(x+\Delta x) &\approx f(x) + \frac{\partial f}{\partial x}\Delta x
  \\
    f(0.22) &\approx f(0.2) + 2\pi\cos{[2\pi(0.2)]}(0.02)
    \\
            &\approx 0.9511 + 0.388 = 0.9899
\end{aligned}
\end{equation}
估算值的相对误差为$(0.9899-0.9823)/0.9823=0.775\%$，相比于第一次的估算值更加接近
精确值。最后，为了获得更加精确的估算值，我们可以利用展开式的前三项，有
\begin{equation}
  \begin{aligned}
    f(x+\Delta x) &\approx f(x) + \frac{\partial f}{\partial x}\Delta x
    +
    \frac{\partial^{2} f}{\partial x^{2}}\frac{(\Delta x)^{2}}{2}
  \\
    f(0.22) &\approx f(0.2) + 2\pi\cos{[2\pi(0.2)]}(0.02) -
    4\pi^{2}\sin{[2\pi(0.2)]}\frac{0.02^{2}}{2}
    \\
            &\approx 0.9511 + 0.0388 - 0.0075
    \\
            &\approx 0.9824
\end{aligned}
\end{equation}
估算值的相对误差为$(0.9824-0.9823)/0.9823=0.01\%$，即仅用泰勒展开式的前三项就可
以得到一个非常接近精确值的估算值。

\section{离散基础知识}
图\ref{FgBD_SMN}中给出了一个结构网格的例子。图中，网格点，即两条网格线的交点，可以用$(i,j)$进
行标示，其中，$i$是沿$x$方向的索引，$j$是沿$y$方向的索引。假定图中$P$的索引为
$(i,j)$，那么，紧邻$P$右边的点的索引为$(i+1,j)$，紧邻$P$左边的点的索引为
$(i-1,j)$，紧邻$P$上边的点的索引为$(i,j+1)$，紧邻$P$下边的点的索引为$(i,j-1)$。
对非恒定流中，离散的当前时间层用上标$n$来标记，下一个时间层用上标$n+1$来标记，前
一个时间层用上标$n-1$来标记。
\begin{figure}[h]
  \centering
  \includegraphics{BDStructureMeshNotion.pdf}
  \caption{结构网格离散网格节点示意}
  \label{FgBD_SMN}
\end{figure}

\subsection{一阶偏导数的差分表达式}
点$(i,j)$上$x$方向速度用$u_{i,j}$表示，点$(i+1,j)$上$x$方向速度$u_{i+1,j}$可以在
点$(i,j)$上通过泰勒级数展开为：
\begin{equation}
  u_{i+1,j}
  =
  u_{i,j} + 
  \left(
    \frac{\partial u}{\partial x}
  \right)_{i,j}
  \Delta x
  +
  \left(
    \frac{\partial^{2} u}{\partial x^{2}}
  \right)_{i,j}
  \frac{(\Delta x)^{2}}{2}
  +
  \left(
    \frac{\partial^{3} u}{\partial x^{3}}
  \right)_{i,j}
  \frac{(\Delta x)^{3}}{3!}
  +
  \cdots
  \label{EqBD_Tsp_F}
\end{equation}
用上式求解$(\partial u/\partial x)_{i,j}$，可得
\begin{equation}
  \left(
    \frac{\partial u}{\partial x}
  \right)_{i,j}
  =
  \underbrace{
  \frac{u_{i+1,j}-u_{i,j}}{\Delta x}
}_{\mbox{差分表达式}}
  -
  \underbrace{
  \left(
    \frac{\partial^{2} u}{\partial x^{2}}
  \right)_{i,j}
  \frac{\Delta x}{2}
  -
  \left(
    \frac{\partial^{3} u}{\partial x^{3}}
  \right)_{i,j}
  \frac{(\Delta x)^{2}}{6}
  +
  \cdots
}_{\mbox{截断误差}}
\label{EqBD_Tes}
\end{equation}
上式中，如果我们用等号右边的差商$(u_{i+1,j}-u_{i,j})/\Delta x$来近似
$(\partial u/\partial x)_{i,j}$，则该项为偏导数的差分表达式，等号右边的其他项为截断误
差，可以省略。即，
\begin{equation}
  \left(
    \frac{\partial u}{\partial x}
  \right)_{i,j}
  \approx
  \frac{u_{i+1,j}-u_{i,j}}{\Delta x}
\end{equation}

式\eqref{EqBD_Tes}也可写成
\begin{equation}
  \left(
    \frac{\partial u}{\partial x}
  \right)_{i,j}
  =
  \frac{u_{i+1,j}-u_{i,j}}{\Delta x}
  +
  O(\Delta x)
  \label{EqBD_1P1AF}
\end{equation}
从上式可看出，被省略的截断误差中$\Delta x$的幂次最小的那一项决定了上式的精度
。截断误差中$\Delta x$的幂次即为式\eqref{EqBD_1P1AF}的精度。上式中截断误差中
$\Delta x$的最小幂次为1。因而，式\eqref{EqBD_1P1AF}为一阶精度，此外，式\eqref{EqBD_1P1AF}
中差分表达式使用了网格点$(i,j)$及其右侧相邻网格点$(i+1,j)$的信息，没有使用
$(i,j)$左侧网格点信息。因此，式\eqref{EqBD_1P1AF}也叫做向前差分。综上，式
\eqref{EqBD_1P1AF}为一阶偏导数$(\partial u/\partial x)_{i,j}$的一阶向前差分。

同理，$u_{i-1,j}$在$(i,j)$上进行泰勒级数展开为
\begin{equation}
  u_{i-1,j}
  =
  u_{i,j} - 
  \left(
    \frac{\partial u}{\partial x}
  \right)_{i,j}
  \Delta x
  +
  \left(
    \frac{\partial^{2} u}{\partial x^{2}}
  \right)_{i,j}
  \frac{(\Delta x)^{2}}{2}
  -
  \left(
    \frac{\partial^{3} u}{\partial x^{3}}
  \right)_{i,j}
  \frac{(\Delta x)^{3}}{3!}
  +
  \cdots
  \label{EqBD_Tsp_B}
\end{equation}
利用上式求解$(\partial u/\partial x)_{i,j}$，得
\begin{equation}
  \left(
    \frac{\partial u}{\partial x}
  \right)_{i,j}
  =
  \frac{u_{i,j}-u_{i-1,j}}{\Delta x}
  +
  O(\Delta x)
  \label{EqBD_1P1AB}
\end{equation}
上式中没有使用网格点$(i,j)$右侧网格点信息。因而，式\eqref{EqBD_1P1AB}为向后差分
。此外，上式中，截断误差中$\Delta x$的最低幂次为1。因此，式\eqref{EqBD_1P1AB}为
一阶偏导数$(\partial u/\partial x)_{i,j}$的一阶向后差分。

在计算水动力学、计算流体力学的实际应用中，一阶精度往往是不够的。为了构造一个二阶
精度的差分，将式\eqref{EqBD_Tsp_B}从式\eqref{EqBD_Tsp_F}中减去：
\begin{equation}
  u_{i+1,j} - u_{i-1,j}
  =
  2
  \left(
    \frac{\partial u}{\partial x}
  \right)_{i,j}
  \Delta x
  +
  2
  \left(
    \frac{\partial^3 u}{\partial x^3}
  \right)_{i,j}
  \frac{(\Delta x)^3}{3!}
  +
  \cdots
\end{equation}
上式可写成
\begin{equation}
  \left(
    \frac{\partial u}{\partial x}
  \right)_{i,j}
  =
  \frac{u_{i+1,j} - u_{i-1,j}}{2\Delta x}
  +
  O(\Delta x)^2
  \label{EqBD_1P2AC}
\end{equation}
式\eqref{EqBD_1P2AC}中使用了点$(i,j)$两侧节点$(i+1,j)$和$(i-1,j)$的信息。另外，
式\eqref{EqBD_1P2AC}中截断误差的最低幂次为2。因此，式\eqref{EqBD_1P2AC}是一阶偏
导数$(\partial u/\partial x)_{i,j}$的二阶中心差分。

同理，可以得到一阶偏导数$(\partial u/\partial y)_{i,j}$和
$(\partial u/\partial t)_{i,j}$
的差分格式。总结如下：
\begin{equation}
  \left(
    \frac{\partial u}{\partial x}
  \right)_{i,j}
  =
  \left\{
    \begin{aligned}
      &\frac{u_{i+1,j}-u_{i,j}}{\Delta x} + O(\Delta x) & \mbox{一阶向前差分} \\
      &\frac{u_{i,j}-u_{i-1,j}}{\Delta x} + O(\Delta x) & \mbox{一阶向后差分} \\
      &\frac{u_{i+1,j}-u_{i-1,j}}{2\Delta x} + O(\Delta x)^{2} \quad& \mbox{二阶中心差分} \\
    \end{aligned}
  \right.
\end{equation}

\begin{equation}
  \left(
    \frac{\partial u}{\partial y}
  \right)_{i,j}
  =
  \left\{
    \begin{aligned}
      &\frac{u_{i,j+1}-u_{i,j}}{\Delta y} + O(\Delta y) & \mbox{一阶向前差分} \\
      &\frac{u_{i,j}-u_{i,j-1}}{\Delta y} + O(\Delta y) & \mbox{一阶向后差分} \\
      &\frac{u_{i,j+1}-u_{i,j-1}}{2\Delta y} + O(\Delta y)^{2} \quad& \mbox{二阶中心差分} \\
    \end{aligned}
  \right.
\end{equation}

\begin{equation}
  \left(
    \frac{\partial u}{\partial t}
  \right)_{i,j}^{n}
  =
  \left\{
    \begin{aligned}
      &\frac{u_{i,j}^{n+1}-u_{i,j}^{n}}{\Delta t} + O(\Delta t) & \mbox{一阶向前差分} \\
      &\frac{u_{i,j}^{n}-u_{i,j}^{n-1}}{\Delta t} + O(\Delta t) & \mbox{一阶向后差分} \\
      &\frac{u_{i,j}^{n+1}-u_{i,j}^{n-1}}{2\Delta t} + O(\Delta t)^{2} \quad& \mbox{二阶中心差分} \\
    \end{aligned}
  \right.
\end{equation}


\subsection{二阶偏导数的差分表达式}
将式\eqref{EqBD_Tsp_F}和式\eqref{EqBD_Tsp_B}相加，可得
\begin{equation}
  u_{i+1,j} + u_{i-1,j}
  =
  2u_{i,j}+
  \left(
    \frac{\partial^{2} u}{\partial x^{2}}
  \right)_{i,j}(\Delta x)^{2}
  +
  \left(
    \frac{\partial^{4} u}{\partial x^{4}}
  \right)_{i,j}\frac{(\Delta x)^{4}}{12}
  +
  \cdots
\end{equation}
利用上式求解出$(\partial^{2}u/\partial x^{2})_{i,j}$，
\begin{equation}
  \left(
    \frac{\partial^{2} u}{\partial x^{2}} 
  \right)_{i,j}
  =
  \frac{u_{i+1,j}-2u_{i,j}+u_{i-1,j}}{(\Delta x)^{2}}
  +
  O(\Delta x)^2
  \label{EqBD_2P2AC}
\end{equation}
式\eqref{EqBD_2P2AC}中，等号右边第一项是二阶偏导数$(\partial^{2}u/\partial x^{2})_{i,j}$的中心差分
截断误差中$\Delta x$的最小幂次为2，因此该式为二阶精度。同理，我们可以得到
$(\partial^{2}u/\partial y^{2})_{i,j}$的二阶精度中心差分，
\begin{equation}
  \left(
    \frac{\partial^{2} u}{\partial y^{2}} 
  \right)_{i,j}
  =
  \frac{u_{i,j+1}-2u_{i,j}+u_{i,j-1}}{(\Delta y)^{2}}
  +
  O(\Delta y)^2
  \label{EqBD_2Py2AC}
\end{equation}

对于二阶混合偏导，如$\partial^{2} u/\partial x\partial y$，可以采用与上面类似的
处理方式得到。首先，将式\eqref{EqBD_Tsp_F}对$y$求偏导，得
\begin{equation}
  \left(
    \frac{\partial u}{\partial y}
  \right)_{i+1,j}
  =
  \left(
    \frac{\partial u}{\partial y}
  \right)_{i,j}
  +
  \left(
    \frac{\partial^{2} u}{\partial x\partial y}
  \right)_{i,j}\Delta x
  +
  \left(
    \frac{\partial^{3} u}{\partial x^{2}\partial y}
  \right)_{i,j}\frac{(\Delta x)^{2}}{2} 
  +
  \left(
    \frac{\partial^{4} u}{\partial x^{3}\partial y}
  \right)_{i,j}\frac{(\Delta x)^{3}}{6} 
  +
  \cdots
  \label{EqBD_Tsp_F_py}
\end{equation}
然后，将式\eqref{EqBD_Tsp_B}对$y$求偏导，得
\begin{equation}
  \left(
    \frac{\partial u}{\partial y}
  \right)_{i-1,j}
  =
  \left(
    \frac{\partial u}{\partial y}
  \right)_{i,j}
  -
  \left(
    \frac{\partial^{2} u}{\partial x\partial y}
  \right)_{i,j}\Delta x
  +
  \left(
    \frac{\partial^{3} u}{\partial x^{2}\partial y}
  \right)_{i,j}\frac{(\Delta x)^{2}}{2} 
  -
  \left(
    \frac{\partial^{4} u}{\partial x^{3}\partial y}
  \right)_{i,j}\frac{(\Delta x)^{3}}{6} 
  +
  \cdots
  \label{EqBD_Tsp_B_py}
\end{equation}
将式\eqref{EqBD_Tsp_F_py}中减去式\eqref{EqBD_Tsp_B_py}，得
\begin{equation}
  \left(
    \frac{\partial u}{\partial y}
  \right)_{i+1,j}
  -
  \left(
    \frac{\partial u}{\partial y}
  \right)_{i-1,j}
  =
  2
  \left(
    \frac{\partial^{2} u}{\partial x\partial y}
  \right)_{i,j}\Delta x
  +
  \left(
    \frac{\partial^{4} u}{\partial x^{3}\partial y}
  \right)_{i,j}\frac{(\Delta x)^{3}}{3} 
  +
  \cdots
\end{equation}
从上式中求解$(\partial^{2}u/\partial x\partial y)$，得
\begin{equation}
  \left(
    \frac{\partial^{2} u}{\partial x\partial y}
  \right)_{i,j}
  =
  \frac{(\partial u/\partial y)_{i+1,j}-(\partial u/\partial y)_{i-1,j}}{2\Delta x}
  -
  \left(
    \frac{\partial^{4} u}{\partial x^{3}\partial y}
  \right)_{i,j}\frac{(\Delta x)^{3}}{6} 
  +
  \cdots
  \label{EqBD_2PM2A}
\end{equation}
上式中等式右侧第一项中需要求解$(\partial u/\partial y)_{i+1,j}$和$(\partial
u/\partial y)_{i-1,j}$。利用上一小节所得到一阶偏导数的中心差分，得
\begin{equation}
  \left(
    \frac{\partial u}{\partial y}
  \right)_{i+1,j}
  =
  \frac{u_{i+1,j+1}-2u_{i+1,j}-u_{i+1,j-1}}{2\Delta y} + O(\Delta y)^{2}
\end{equation}
\begin{equation}
  \left(
    \frac{\partial u}{\partial y}
  \right)_{i-1,j}
  =
  \frac{u_{i-1,j+1}-2u_{i-1,j}-u_{i-1,j-1}}{2\Delta y} + O(\Delta y)^{2}
\end{equation}
将上两式代入式\eqref{EqBD_2PM2A}，可得
\begin{equation}
  \left(
    \frac{\partial^{2} u}{\partial x\partial y}
  \right)_{i,j}
  =
  \frac{u_{i+1,j+1}-u_{i+1,j-1}-u_{i-1,j+1}+u_{i-1,j-1}}{4\Delta x\Delta y}
  +
  O[(\Delta x)^{2},(\Delta y)^{2}]
\end{equation}

本节所列出的差分格式只是所有差分格式的一小部分。同一个导数可以有许多不同的差分
格式，特别是更高精度的差分格式。高精度的差分格式通常需要引入更多网格点的信息。例
如，下式给出的$\partial^{2} u/\partial x^{2}$的四阶精度中心差分格式：
\begin{equation}
  \left(
    \frac{\partial^{2} u}{\partial x^{2}}
  \right)_{i,j}
  =
  \frac{-u_{i+2,j}+16u_{i+1,j}-30u_{i,j}+16u_{i-2,j}-u_{i-2,j}}{12(\Delta x)^{2}}
  +
  O(\Delta x)^{4}
\end{equation}

\subsection{待定系数法}
高阶格式的推导可用待定系数法得出。以上述的四阶精度中心差分格式推导为例。
我们需要利用$(i-2,j), (i-1,j), (i,j), (i+1,j),
(i+2,j)$这几个节点来构造出四阶精度的差分格式，即
\begin{equation}
  \left(
    \frac{\partial^{2} u}{\partial x^{2}}
  \right)_{i,j}
  =
  Au_{i+2,j}+Bu_{i+1,j}+Cu_{i,j}+Du_{i-2,j}+Eu_{i-2,j}
  +
  O(\Delta x)^{4}
\end{equation}
其中，系数$A, B, C, D, E$分别为待定系数。

首先，利用泰勒级数展开
将这$u_{i-2,j}, u_{i-1,j}, u_{i+1,j}, u_{i+2,j}$在$(i,j)$上展开，得：
\begin{equation}
  \begin{aligned}
    &\begin{aligned}
      u_{i-2,j}  =
      u_{i,j} &+
      \left(
        \frac{\partial u}{\partial x}
      \right)_{i,j}
      (-2\Delta x)
      +
      \left(
        \frac{\partial^{2} u}{\partial x^{2}}
      \right)_{i,j}
      \frac{(-2\Delta x)^{2}}{2}
      +
      \left(
        \frac{\partial^{3} u}{\partial x^{3}}
      \right)_{i,j}
      \frac{(-2\Delta x)^{3}}{3!}
      \\
              & 
              +
              \left(
                \frac{\partial^{4} u}{\partial x^{4}}
              \right)_{i,j}
              \frac{(-2\Delta x)^{4}}{4!}
              +
              \left(
                \frac{\partial^{5} u}{\partial x^{5}}
              \right)_{i,j}
              \frac{(-2\Delta x)^{5}}{5!}
              +
              \left(
                \frac{\partial^{6} u}{\partial x^{6}}
              \right)_{i,j}
              \frac{(-2\Delta x)^{6}}{6!}
              +
              \cdots
    \end{aligned}
    \\
    &\begin{aligned}
      u_{i-1,j}  =
      u_{i,j} &+
      \left(
        \frac{\partial u}{\partial x}
      \right)_{i,j}
      (-\Delta x)
      +
      \left(
        \frac{\partial^{2} u}{\partial x^{2}}
      \right)_{i,j}
      \frac{(-\Delta x)^{2}}{2}
      +
      \left(
        \frac{\partial^{3} u}{\partial x^{3}}
      \right)_{i,j}
      \frac{(-\Delta x)^{3}}{3!}
      \\
              & 
              +
              \left(
                \frac{\partial^{4} u}{\partial x^{4}}
              \right)_{i,j}
              \frac{(-\Delta x)^{4}}{4!}
              +
              \left(
                \frac{\partial^{5} u}{\partial x^{5}}
              \right)_{i,j}
              \frac{(-\Delta x)^{5}}{5!}
              +
              \left(
                \frac{\partial^{6} u}{\partial x^{6}}
              \right)_{i,j}
              \frac{(-\Delta x)^{6}}{6!}
              +
              \cdots
    \end{aligned}
    \\
    &u_{i,j} = u_{i, j}
    \\
    &\begin{aligned}
      u_{i+1,j}  =
      u_{i,j} &+
      \left(
        \frac{\partial u}{\partial x}
      \right)_{i,j}
      (\Delta x)
      +
      \left(
        \frac{\partial^{2} u}{\partial x^{2}}
      \right)_{i,j}
      \frac{(\Delta x)^{2}}{2}
      +
      \left(
        \frac{\partial^{3} u}{\partial x^{3}}
      \right)_{i,j}
      \frac{(\Delta x)^{3}}{3!}
      \\
              & 
              +
              \left(
                \frac{\partial^{4} u}{\partial x^{4}}
              \right)_{i,j}
              \frac{(\Delta x)^{4}}{4!}
              +
              \left(
                \frac{\partial^{5} u}{\partial x^{5}}
              \right)_{i,j}
              \frac{(\Delta x)^{5}}{5!}
              +
              \left(
                \frac{\partial^{6} u}{\partial x^{6}}
              \right)_{i,j}
              \frac{(\Delta x)^{6}}{6!}
              +
              \cdots
    \end{aligned}
    \\
    &\begin{aligned}
      u_{i+2,j}  =
      u_{i,j} &+
      \left(
        \frac{\partial u}{\partial x}
      \right)_{i,j}
      (2\Delta x)
      +
      \left(
        \frac{\partial^{2} u}{\partial x^{2}}
      \right)_{i,j}
      \frac{(2\Delta x)^{2}}{2}
      +
      \left(
        \frac{\partial^{3} u}{\partial x^{3}}
      \right)_{i,j}
      \frac{(2\Delta x)^{3}}{3!}
      \\
              & 
              +
              \left(
                \frac{\partial^{4} u}{\partial x^{4}}
              \right)_{i,j}
              \frac{(2\Delta x)^{4}}{4!}
              +
              \left(
                \frac{\partial^{5} u}{\partial x^{5}}
              \right)_{i,j}
              \frac{(2\Delta x)^{5}}{5!}
              +
              \left(
                \frac{\partial^{6} u}{\partial x^{6}}
              \right)_{i,j}
              \frac{(2\Delta x)^{6}}{6!}
              +
              \cdots
    \end{aligned}
  \end{aligned}
\end{equation}

对上式各式分别乘以系数$A,B,C,D,E$得：
\begin{equation}
\begin{aligned}
  &Au_{i-2,j}+Bu_{i-1,j}+Cu_{i,j}+Du_{i+1,j}+Eu_{i+2,j} 
  \\
  =
  &(A+B+C+D+E)u_{i,j}
  +
  \\
  &
  (-2A-B+D+2E)
  \left(
    \frac{\partial u}{\partial x}
  \right)_{i,j}
  \Delta x
  +
  \\
  &
  \left(2A+\frac{B}{2}+\frac{D}{2}+2E\right)
  \left(
    \frac{\partial^{2} u}{\partial x^{2}}
  \right)_{i,j}
  (\Delta x)^{2}
  +
  \\
  &
  \left(-\frac{4}{3}A-\frac{B}{6}+\frac{D}{6}+\frac{4}{3}E\right)
  \left(
    \frac{\partial^{3} u}{\partial x^{3}}
  \right)_{i,j}
  (\Delta x)^{3}
  +
  \\
  &
  \left(\frac{2}{3}A+\frac{B}{24}+\frac{D}{24}+\frac{2}{3}E\right)
  \left(
    \frac{\partial^{4} u}{\partial x^{4}}
  \right)_{i,j}
  (\Delta x)^{4}
  +
  \\
  &
  \left(-\frac{4}{15}A-\frac{B}{60}+\frac{D}{60}+\frac{4}{15}E\right)
  \left(
    \frac{\partial^{5} u}{\partial x^{5}}
  \right)_{i,j}
  (\Delta x)^{5}
  +
  \\
  &
  \left(\frac{4}{45}A+\frac{B}{120}+\frac{D}{120}+\frac{4}{45}E\right)
  \left(
    \frac{\partial^{6} u}{\partial x^{6}}
  \right)_{i,j}
  (\Delta x)^{6}
  +
  \cdots
\end{aligned}
\end{equation}
根据四阶精度要求，可得
\begin{equation}
  \begin{aligned}
    A+B+C+D+E = 0 \\
    -2A-B+D+2E = 0 \\
    \left(2A+\frac{B}{2} + \frac{D}{2} + 2E\right)(\Delta x)^{2} = 1 \\
    -\frac{4}{3}A-\frac{B}{6}+\frac{D}{6}+\frac{4}{3}E = 0 \\
    \frac{2}{3}A+\frac{B}{24}+\frac{D}{24}+\frac{2}{3}E = 0 \\
    -\frac{4}{15}A-\frac{B}{60}+\frac{D}{60}+\frac{4}{15}E = 0 \\
  \end{aligned}
\end{equation}
且
\begin{equation}
    \frac{4}{45}A+\frac{B}{120}+\frac{D}{120}+\frac{4}{45}E \neq 0
\end{equation}
从上两式可以解出：
\begin{equation}
  A = \frac{-1}{12(\Delta x)^{2}}
  ,
  B = \frac{16}{12(\Delta x)^{2}}
  ,
  C = \frac{-30}{12(\Delta x)^{2}}
  ,
  D = \frac{16}{12(\Delta x)^{2}}
  ,
  E = \frac{-1}{12(\Delta x)^{2}}
\end{equation}

\subsection{多项式拟合法}
除了待定系数法外，另一个推导差分格式的方法是多项式拟合法，特别是在推导边界节点处
高精度差分格式。

例如，网格节点1位于边界上，$y$方向垂直与边界，节点2和3分别距边界$\Delta y$和
$2\Delta y$。我们希望构建$\partial u/\partial y$的差分格式。最简单的格式为
\begin{equation}
  \left(
  \frac{\partial u}{\partial y}
\right)_{1}
=
\frac{u_{2}-u_{1}}{\Delta y} 
+
O(y)
\end{equation}
然而，该格式仅有一阶精度。若采用中心差分格式，边界节点1下面没有节点可用了。早期
，为了处理这一问题，假定在边界节点1外面存在一个虚拟的节点$2^{\prime}$，且
$u_{2^{\prime}}=u_{2}$，即假定边界为反射性边界条件。采用多项式拟合法可以直接得到
二阶精度，甚至是更高阶精度格式，而不需要引入上述假定。

首先，假定在边界附近，函数$u$可以用二次多项式表示，即
\begin{equation}
  u = a + by + cy^{2}
  \label{EqBD_u_polynomial}
\end{equation}
在节点1处，$y=0$，$u_{1}=a$。在节点2处，$y=\Delta y$，$u_{2}=a + b\Delta y +
c(\Delta y)^{2}$。在节点3处，$y=2\Delta y$，$u_{3} = a + b(2\Delta y)+c(2\Delta
y)^{2}$。联立求解三个节点的方程，可得
\begin{equation}
  b =
  \frac{-3u_{1}+4u_{2}-u_{3}}{2\Delta y}
  \label{EqBD_b}
\end{equation}

接着，对式\eqref{EqBD_u_polynomial}对$y$求导，
\begin{equation}
\frac{\partial u}{\partial y}
=
b + 2cy
\end{equation}
在节点1处，$y=0$，即
\begin{equation}
  \left(
\frac{\partial u}{\partial y}
  \right)_{1}
  =
  b
  \label{EqBD_pupy}
\end{equation}
对比式\eqref{EqBD_b}和\eqref{EqBD_pupy}，可得
\begin{equation}
  \left(
\frac{\partial u}{\partial y}
  \right)_{1}
  =
  \frac{-3u_{1}+4u_{2}-u_{3}}{2\Delta y}
  \label{EqBD_poly_de}
\end{equation}
该式即为边界处的单侧差分格式。该格式的精度可利用泰勒级数展开来判断。$u(y)$在节点
1处的泰勒级数展开式为：
\begin{equation}
  u(y) = 
  u_{1}
  +
  \left(
  \frac{\partial u}{\partial y}
  \right)_{1}y
  +
  \left(
    \frac{\partial^{2} u}{\partial y^{2}}
  \right)_{1}
  \frac{y^{2}}{2}
  +
  \left(
    \frac{\partial^{3} u}{\partial y^{3}}
  \right)_{1}
  \frac{y^{3}}{3!}
  +
  \cdots
  \label{EqBD_u_fsp}
\end{equation}
对比式\eqref{EqBD_u_fsp}和\eqref{EqBD_u_polynomial}，我们可以认为式
\eqref{EqBD_u_polynomial}对应泰勒级数的前三项。因此，式
\eqref{EqBD_u_polynomial}的截断误差为$O(\Delta y)^{3}$。因而，
$u_{1},u_{2},u_{3}$的精度均为$O(\Delta y)^{3}$。在式
\eqref{EqBD_poly_de}中，分子精度也为$O(\Delta y)^{3}$，分母中存在$\Delta y$，整
个差分表达式的精度为$O(\Delta y)^{2}$，
\begin{equation}
  \left(
\frac{\partial u}{\partial y}
  \right)_{1}
  =
  \frac{-3u_{1}+4u_{2}-u_{3}}{2\Delta y}
  +
  O(\Delta y)^{2}
\end{equation}

\section{差分方程}
上节中我们讨论了如何用各类代数差分来替代一个偏导数。上一章所推导各类偏微分方程组
中通常涉及到大量的偏导数项。当给定的偏微分方程中所有的偏导数项都被差分替代后，最
终得到的代数方程为差分方程，是原偏微分方程的线性替代。本节，我们将讨论有关差分方
程的基础概念。

为了简化，我们选用热传导系数为常数的一维热传导方程，
\begin{equation}
\frac{\partial T}{\partial t}
=
\alpha
\frac{\partial^{2} T}{\partial x^{2}}
\label{EqBD_1dht}
\end{equation}
选用该方程主要是出于方便的考虑。目前，我们主要是希望讲解差分方程的基础概念，若直接
处理复杂的流动控制方程是没有好处的。

式\eqref{EqBD_1dht}中包含了两个自变量，$x$和$t$。

\begin{equation}
  \left(
    \frac{\partial T}{\partial t}
  \right)_{i}^{n}
  =
  \frac{T_{i}^{n+1}-T_{i}^{n}}{\Delta t}
  -
  \left(
    \frac{\partial^{2} T}{\partial t^{2}}
  \right)_{i}^{n}
  \frac{\Delta t}{2}
  +
  \cdots
\end{equation}

\begin{equation}
  \left(
    \frac{\partial^{2} T}{\partial x^{2}}
  \right)_{i}^{n}
  =
  \frac{T_{i+1}^{n}-2T_{i}^{n}+T_{i-1}^{n}}{(\Delta x)^2}
  -
  \left(
    \frac{\partial^{4} T}{\partial x^{4}}
  \right)_{i}^{n}
  \frac{(\Delta x)^{2}}{12}
  +
  \cdots
\end{equation}

\begin{equation}
  \begin{aligned}
    \frac{\partial T}{\partial t}
    -
    \alpha
    \frac{\partial T}{\partial x^{2}}
    =
    0
    =
    \frac{T_{i}^{n+1}-T_{i}^{n}}{\Delta t}
    &-
    \frac{T_{i+1}^{n}-2T_{i}^{n}+T_{i-1}^{n}}{(\Delta x)^2}
    \\
    &+
    \left[
      -
      \left(
        \frac{\partial^{2} T}{\partial t^{2}}
      \right)_{i}^{n}
      \frac{\Delta t}{2}
      +
      \left(
        \frac{\partial^{4} T}{\partial x^{4}}
      \right)_{i}^{n}
      \frac{(\Delta x)^{2}}{12}
      +
      \cdots
    \right]
  \end{aligned}
  \label{EqBD_1dht_pede}
\end{equation}

\begin{equation}
    \frac{T_{i}^{n+1}-T_{i}^{n}}{\Delta t}
    =
    \frac{T_{i+1}^{n}-2T_{i}^{n}+T_{i-1}^{n}}{(\Delta x)^2}
    \label{EqBD_1dht_de}
\end{equation}
式\eqref{EqBD_1dht_de}即为式\eqref{EqBD_1dht}中偏微分方程的差分方程。需要注意的是，式
\eqref{EqBD_1dht_de}只是式\eqref{EqBD_1dht}的近似，式\eqref{EqBD_1dht_de}中每一个差商都有
一个截断误差，因此式\eqref{EqBD_1dht_de}所表达的差分方程综合了每一个差商的截断误
差。从式\eqref{}可以看出，式\eqref{EqBD_1dht_de}的截断误差为$O[\Delta t, (\Delta
x)^{2}]$。

更重要的是，差分方程和原始对偏微分方程是完全不同的。差分方程是一个代数方程。网格
中，每一个网格节点都上可以列出一个差分方程，最后组成一个线性方程组。然后，通过求
解该线性方程组得出每个网格节点上下一个时刻的温度。这里我们需要注意一个问题，求解
该线性方程组所得的解是否就是偏微分方程的解？仔细观察式\eqref{EqBD_1dht_pe_de}，
我们可以认为，当$\Delta x \rightarrow 0$和$\Delta t \rightarrow 0$时，截断误差趋
近于0，差分方程就会退化成原先的偏微分方程，差分方程的解确实是偏微分方程的解。这
种情况下，偏微分方程的有限差分表达式被认为是\textbf{相容的}。但
是对于有限间隔的网格系统来说，有限差分

\section{相容性、稳定性和收敛性}

